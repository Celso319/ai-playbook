#- name: Download yolov10m.onnx model for WanVideo
#  ansible.builtin.get_url:
#    url: "https://huggingface.co/Wan-AI/Wan2.2-Animate-14B/resolve/main/process_checkpoint/det/yolov10m.onnx"
#    dest: "{{ comfy_dir }}/models/detection/yolov10m.onnx"
#    mode: '0644'
#    timeout: 300
#    headers:
#      User-Agent: "Mozilla/5.0 (Compatible; Ansible)"
#  register: download_result
#  until: download_result is succeeded
#  retries: 3
##  delay: 10
---
- name: Ensure specific model subdirectories exist
  ansible.builtin.file:
    path: "{{ comfy_dir }}/{{ item.dest }}"
    state: directory
    mode: '0755'
  loop: "{{ wan_models }}"
  loop_control:
    label: "Path: {{ item.dest }}"

- name: Download WanVideo models from HuggingFace
  ansible.builtin.get_url:
    url: "{{ item.url }}"
    dest: "{{ comfy_dir }}/{{ item.dest }}/{{ item.name }}"
    mode: '0644'
    # Models are huge; 30 min timeout to be safe
    timeout: 1800 
    # Important: Don't re-download if file already exists
    force: no
  loop: "{{ wan_models }}"
  loop_control:
    label: "File: {{ item.name }}"